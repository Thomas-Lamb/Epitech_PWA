import{b as $,r as z,o as b,e as A,f as p,a2 as h,i as t,$ as _,a0 as O,a9 as L,g as n,a4 as m,a as N,a5 as C,aa as T,Y as Q,ab as R,ac as Z,ad as Y,h as J,ae as D,af as K,ag as W}from"./50dd3815.js";import{d as X,u as B}from"../assets/app-d41f575b.js";import{B as w}from"./5b39eb61.js";const tt={class:"row"},ot={class:"col-md-12"},st={class:"row"},et={class:"col-md-12"},nt=t("br",null,null,-1),at={class:"row"},it={class:"col-md-12"},rt={class:"e-input-group data",style:{width:"200px"}},dt={class:"e-footer-content mt-4"},lt=$({__name:"secondAuthPopup",props:{token:{}},emits:["close"],setup(y,{emit:r}){const o=y,d=r;o.token;function l(){N.post("api/restartSecondAuth",{token:this.tokenSecondAuth}).then(e=>{this.tokenSecondAuth=e.data.tokenSecondAuth,this.showCenterToast(this.trans.get("__JSON__.main.content.secondAuthSentAgain"),"e-toast-success")}).catch(e=>{let i=e.response.data.error;this.showCenterToast(i,"e-toast-danger"),e.response.data.hasOwnProperty("expired")&&g()})}function v(){this.code&&this.code!==""?N.post("api/secondAuthLogin",{code:this.code,token:this.tokenSecondAuth}).then(e=>{this.$emit("logged",e.data)}).catch(e=>{let i=e.response.data.error;this.showCenterToast(i,"e-toast-danger"),e.response.data.hasOwnProperty("expired")&&g()}):this.showCenterToast(this.trans.get("__JSON__.main.content.pleaseEnterSecondAuthCode"),"e-toast-info")}function g(){d("close")}return(e,i)=>{const u=z("ejs-dialog");return b(),A("div",null,[p(u,{ref:"modalEdition",visible:"true",header:e.trans.get("__JSON__.main.content.secondAuth"),animationSettings:e.animationSettings,close:g,allowDragging:!0,width:e.width,isModal:"true"},{default:h(()=>[t("div",tt,[t("div",ot,[t("div",st,[t("div",et,_(e.trans.get("__JSON__.main.content.enterSecondAuthCode")),1)]),nt,t("div",at,[t("div",it,[t("div",rt,[O(t("input",{class:"e-input mb-0",type:"text","onUpdate:modelValue":i[0]||(i[0]=f=>e.code=f)},null,512),[[L,e.code,void 0,{lazy:!0}]])])])])]),t("div",dt,[t("span",null,[p(n(w),{class:"e-control e-btn sendButton",style:{background:"green",color:"white"},onClick:l},{default:h(()=>[m(_(e.trans.get("__JSON__.main.modal.button.sendAgain")),1)]),_:1}),p(n(w),{class:"e-control e-btn sendButton",onClick:g},{default:h(()=>[m(_(e.trans.get("__JSON__.main.modal.button.cancel")),1)]),_:1}),p(n(w),{cssClass:"e-info",class:"e-control e-btn e-primary sendButton",onClick:v},{default:h(()=>[m(_(e.trans.get("__JSON__.main.modal.button.continue")),1)]),_:1})])])])]),_:1},8,["header","animationSettings","width"])])}}}),ct={class:"form-title"},ut=["src"],_t={id:"input-container"},gt={class:"input-login form-group"},ft={class:"e-float-input"},pt=t("span",{class:"e-float-line"},null,-1),ht={class:"e-float-text"},mt={class:"input-login"},wt={class:"e-float-input form-group"},St=t("span",{class:"e-float-line"},null,-1),bt={class:"e-float-text"},vt={key:0,id:"credentialsError",class:"e-error"},Pt={class:"first-btns"},yt={class:"w-50"},kt={class:"submit-btn mt-3"},At={class:"w-50"},Ct={class:"submit-btn mt-3"},Ot={class:"or-container mt-5 mb-3",style:{display:"flex","text-align":"center","align-items":"center","margin-top":"15px"}},Lt=t("hr",{class:"login-separator",style:{"text-align":"center"}},null,-1),Nt={class:"or-label"},$t=t("hr",{class:"login-separator"},null,-1),Et={class:"d-flex",style:{display:"flex","justify-content":"space-around","margin-top":"15px"}},Jt={class:"w-50 text-center"},xt=t("i",{class:"sf-icon-google sf-icon"},null,-1),Ft={class:"w-50 text-center"},It=t("i",{class:"sf-icon-microsoft sf-icon"},null,-1),Mt=$({__name:"FormLogin",props:{data:{},srcImg:{}},emits:["forgotPassword","onFormSubmit","oauthGoogle","oauthMicrosoft"],setup(y,{emit:r}){const o=window.trans,d=r,l=X();function v(){d("forgotPassword","toto")}function g(){d("onFormSubmit")}function e(){d("oauthGoogle")}function i(){d("oauthMicrosoft")}return(u,f)=>(b(),A("form",{id:"form-login",class:"e-lib e-formvalidator",onSubmit:f[2]||(f[2]=T(()=>{},["prevent"]))},[t("h3",ct,[t("img",{id:"logo-login",src:u.srcImg,alt:"QuickMaint"},null,8,ut)]),t("div",_t,[t("div",gt,[t("div",ft,[O(t("input",{type:"text",id:"login",name:"login","onUpdate:modelValue":f[0]||(f[0]=S=>u.data.login=S),required:""},null,512),[[L,u.data.login]]),pt,t("label",ht,_(n(o).get("__JSON__.user.value.login")),1)])]),t("div",mt,[t("div",wt,[O(t("input",{type:"password","onUpdate:modelValue":f[1]||(f[1]=S=>u.data.password=S),required:""},null,512),[[L,u.data.password]]),St,t("label",bt,_(n(o).get("__JSON__.user.value.password")),1)])])]),u.data.errorCredentials?(b(),A("div",vt,"Identifiant ou mot de passe incorrect")):C("",!0),t("div",Pt,[t("div",yt,[t("div",kt,[p(n(w),{type:"button",id:"recup-password",cssClass:"e-link e-small",style:{padding:"0px","margin-left":"10px"},onClick:v},{default:h(()=>[m(_(n(o).get("__JSON__.main.content.passwordForgot")),1)]),_:1})])]),t("div",At,[t("div",Ct,[p(n(w),{id:"submit-btn",cssClass:"e-btn",style:{"margin-right":"10px"},onClick:g},{default:h(()=>[m(_(n(o).get("__JSON__.main.content.signIn")),1)]),_:1})])])]),t("div",Ot,[Lt,t("div",Nt,_(n(o).get("__JSON__.main.login.orSignIn")),1),$t]),t("div",Et,[t("div",Jt,[p(n(w),{disabled:n(l).mix_config?!n(l).mix_config.HAS_GOOGLE_OAUTH:!0,id:"oauthGoogle",class:"oauth-btn",type:"button",onClick:e},{default:h(()=>[xt,m(" Google ")]),_:1},8,["disabled"])]),t("div",Ft,[p(n(w),{disabled:n(l).mix_config?!n(l).mix_config.HAS_AZURE_OAUTH:!0,id:"oauthMicrosoft",class:"oauth-btn",type:"button",onClick:i},{default:h(()=>[It,m(" Microsoft ")]),_:1},8,["disabled"])])])],32))}}),Dt={class:"form-title"},Bt=["src"],Tt={id:"input-container"},Ut={class:"input-login form-group"},Vt={class:"e-float-input"},Gt=t("span",{class:"e-float-line"},null,-1),jt={class:"e-float-text"},qt={class:"first-btns"},Ht={class:"w-50"},zt={class:"submit-btn mt-3"},Qt={class:"w-50"},Rt={class:"submit-btn mt-3"},Zt=$({__name:"FormForgotPassword",props:{data:{},srcImg:{}},emits:["submitForgotPassword","forgotPassword"],setup(y,{emit:r}){const o=y,d=window.trans,l=r;function v(){o.data.forgotPasswordLogin!=""&&l("submitForgotPassword")}function g(){l("forgotPassword")}return(e,i)=>(b(),A("form",{id:"form-forgot-password",class:"e-lib e-formvalidator",onSubmit:i[1]||(i[1]=T(()=>{},["prevent"]))},[t("h3",Dt,[t("img",{id:"logo-login",src:e.srcImg,alt:"QuickMaint"},null,8,Bt)]),t("div",Tt,[t("div",Ut,[t("div",Vt,[O(t("input",{type:"login","onUpdate:modelValue":i[0]||(i[0]=u=>e.data.forgotPasswordLogin=u),required:""},null,512),[[L,e.data.forgotPasswordLogin]]),Gt,t("label",jt,_(n(d).get("__JSON__.user.value.login")),1)])])]),t("div",qt,[t("div",Ht,[t("div",zt,[p(n(w),{onClick:g,type:"button",id:"recup-password",cssClass:"e-link e-small",style:{padding:"0px","margin-left":"10px"}},{default:h(()=>[m(_(n(d).get("__JSON__.main.modal.button.cancel")),1)]),_:1})])]),t("div",Qt,[t("div",Rt,[p(n(w),{type:"submit",id:"submit-btn",cssClass:"e-btn",style:{"margin-right":"10px"},onClick:v},{default:h(()=>[m(_(n(d).get("__JSON__.user.content.changePassword")),1)]),_:1})])])])],32))}}),Yt={id:"boxLogin",class:""},Kt=t("div",{id:"spinnerLogin"},null,-1),Wt={class:"control_wrapper e-card",id:"wrapper-login"},Xt={class:"e-card-stacked"},to={class:"e-card-content"},no=$({__name:"Login",props:{functionLogin:{type:Function,default:B().login},primaryColor:{default:"#D66D26"},secondaryColor:{default:"#D3D3D3"},srcImg:{default:"/img/icons/logo-text-claire.svg"},authStore:{default:B()}},setup(y){const r=y,o=Q({login:"",password:"",forgotPasswordLogin:"",errorLogin:!1,errorPassword:!1,errorCredentials:!1,forgotPassword:!1,spinnerLogin:null,showSecondAuthPopup:!1,secondAuthToken:null,dialogElement:null,googleAuthDisabled:!0,microsoftAuthDisabled:!0});R(()=>{let s;s=document.querySelectorAll(".e-float-input input"),s.forEach(a=>{a.addEventListener("focus",function(){this.parentElement.classList.add("e-input-focus")}),a.addEventListener("blur",function(){this.parentElement.classList.remove("e-input-focus")})}),o.spinnerLogin=document.getElementById("spinnerLogin"),Z({target:o.spinnerLogin})});function d(){K(o.spinnerLogin)}function l(){D(o.spinnerLogin)}function v(){o.errorCredentials=!0}function g(){if(o.errorPassword=!1,o.errorLogin=!1,o.errorCredentials=!1,o.login===""&&(o.errorLogin=!0),o.password===""&&(o.errorPassword=!0),!o.errorLogin&&!o.errorPassword){let s={login:o.login,password:o.password};r.functionLogin(s,d,l,v)}}function e(){d();let s={login:o.forgotPasswordLogin};N.post(api_path+"forgotPassword",s).then(()=>{l(),S(trans.get("__JSON__.main.modal.toast.success.email"),"e-toast-success",trans.get("__JSON__.user.toast.success.mailChangePassword")),E()}).catch(a=>{l(),console.error(a)}),o.forgotPasswordLogin=""}function i(s,a){let c=document.getElementById(s);return u(c,a)}function u(s,a){if(!s)return null;let c=null,P=null;return s&&s.ej2_instances&&s.ej2_instances.forEach(k=>{P||(P=k),typeof k[a]=="function"&&(c=k)}),c||(c=P),c}function f(s,a,c="e-toast-success",P="",k=5e3){let M=i(s,"show");M&&M.show({title:a,content:P,cssClass:c,timeout:k})}function S(s,a="e-toast-success",c="",P=5e3){f("center_toast",s,a,c,P)}function U(){I("GoogleOAuth")}function V(){I("AzureOAuth")}function G(){x(),r.authStore.secondAuthLogin({dataSource:o,spinnerOn:d,spinnerOff:l})}function x(){r.authStore.setShowSecondAuthPopup(!1),r.authStore.secondAuthToken=!1}function j(){F(trans.get("__JSON__.main.content.passwordNeedUpdate"))}function q(){F(trans.get("__JSON__.main.content.passwordExpired"))}function F(s){o.dialogElement=W.alert({title:trans.get("__JSON__.main.content.passwordRenewalNeeded"),content:s,okButton:{text:trans.get("__JSON__.main.modal.button.ok"),click:H},showCloseIcon:!0,closeOnEscape:!0,animationSettings:{effect:"Zoom"}})}function H(){o.dialogElement&&o.dialogElement.hide()}function I(s){N.get(api_path+"oauth_connect/"+s).then(a=>{let c=a.data.result;c===!0||c===!1?a.data.result?S(trans.get("__JSON__.connection.toast.success.test"),"e-toast-success"):S(trans.get("__JSON__.connection.toast.warning.test"),"e-toast-warning"):location.href=c}).catch(()=>{D(document.getElementById("spinnerMainConnection")),S(trans.get("__JSON__.connection.toast.error.test"),"e-toast-danger")})}function E(){if(o.forgotPassword){o.forgotPassword=!1;return}if(!o.forgotPassword){o.forgotPassword=!0;return}}return Y(()=>{r.authStore.showPasswordValidationDateExpired&&(q(),r.authStore.showPasswordValidationDateExpired=!1),r.authStore.showPasswordNeedUpdate&&(j(),r.authStore.showPasswordNeedUpdate=!1)}),(s,a)=>(b(),A("div",Yt,[Kt,t("div",Wt,[t("div",Xt,[t("div",to,[!o.forgotPassword&&!s.authStore.showSecondAuthPopup?(b(),J(Mt,{key:0,data:o,"src-img":s.srcImg,onForgotPassword:E,onOnFormSubmit:g,onOauthGoogle:U,onOauthMicrosoft:V,"function-login":s.functionLogin},null,8,["data","src-img","function-login"])):C("",!0),o.forgotPassword?(b(),J(Zt,{key:1,data:o,"src-img":s.srcImg,onForgotPassword:E,onSubmitForgotPassword:e},null,8,["data","src-img"])):C("",!0),s.authStore.showSecondAuthPopup?(b(),J(lt,{key:2,token:s.authStore.secondAuthToken,onClose:x,onLogged:G},null,8,["token"])):C("",!0)])])])]))}});export{no as default};
